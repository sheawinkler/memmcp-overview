<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Architecture | Context Lattice</title>
  <link rel="stylesheet" href="styles-gray.css?v=20260221b" />
</head>
<body class="home arch-page">
  <main class="container">
    <header class="topbar">
      <a class="brand" href="index.html">
        <span class="brand-mark" aria-hidden="true"></span>
        <span class="brand-copy"><span class="brand-label">Context Lattice</span><span class="brand-sub">By Private Memory Corp</span></span>
      </a>
      <nav class="nav" aria-label="Primary">
        <a href="index.html">Home</a>
        <a class="active" href="architecture.html">Architecture</a>
        <a href="updates.html">Updates</a>
        <a href="installation.html">Installation</a>
        <a href="integration.html">Integrations</a>
        <a href="troubleshooting.html">Troubleshooting</a>
        <a href="contact.html">Contact</a>
        <a href="v1/">v1</a>
      </nav>
    </header>

    <section class="hero">
      <span class="badge">System blueprint</span>
      <h1>Layered architecture for long-horizon memory, retrieval, and learning.</h1>
      <p class="sub">
        Context view defines boundaries. Container view defines responsibilities and protocols.
        Runtime view defines sequencing and feedback loops.
      </p>
      <div class="cta-row">
        <a class="cta primary" href="index.html">Back to overview</a>
        <a class="cta secondary" href="installation.html">Install guide</a>
      </div>
    </section>

    <section class="section section-tight">
      <article class="card quick-path-card">
        <div class="kicker">Quick Path</div>
        <h3>How to read this architecture set</h3>
        <ol class="step-list">
          <li>Start with <strong>System Context</strong> to see boundary and external dependencies.</li>
          <li>Use <strong>Container View</strong> for service responsibilities and flow types.</li>
          <li>Use <strong>Runtime + Ops</strong> for write/retrieval order and reliability controls.</li>
        </ol>
      </article>
    </section>

    <section class="section section-tight">
      <nav class="page-nav-inline" aria-label="On this page">
        <a href="#arch-context">Context</a>
        <a href="#arch-container">Containers</a>
        <a href="#arch-runtime">Runtime</a>
        <a href="#arch-ops">Ops + Safety</a>
      </nav>
    </section>

    <section class="section" id="arch-context">
      <div class="kicker">C4 Level 1</div>
      <h2>System Context View</h2>
      <div class="grid arch-split">
        <article class="card architecture-board">
          <svg class="arch-svg ji" viewBox="0 0 1120 560" role="img" aria-label="System context diagram showing external actors, context lattice boundary, and external dependencies">
            <defs>
              <linearGradient id="ctx-panel" x1="0" x2="0" y1="0" y2="1">
                <stop offset="0%" stop-color="#1d2229" stop-opacity="0.9"/>
                <stop offset="100%" stop-color="#151a20" stop-opacity="0.9"/>
              </linearGradient>
              <linearGradient id="ctx-core" x1="0" x2="1" y1="0" y2="1">
                <stop offset="0%" stop-color="#222933" stop-opacity="0.98"/>
                <stop offset="100%" stop-color="#171c23" stop-opacity="0.98"/>
              </linearGradient>
              <radialGradient id="ctx-glow" cx="50%" cy="40%" r="60%">
                <stop offset="0%" stop-color="#d5e9ff" stop-opacity="0.10"/>
                <stop offset="100%" stop-color="#d5e9ff" stop-opacity="0"/>
              </radialGradient>
              <marker id="ctx-arrow" markerWidth="12" markerHeight="12" refX="10" refY="6" orient="auto">
                <path d="M0,0 L12,6 L0,12 z" fill="#dbe3ee"></path>
              </marker>
            </defs>

            <rect x="0" y="0" width="1120" height="560" fill="url(#ctx-glow)"></rect>

            <text class="arch-title" x="560" y="52" text-anchor="middle">System Context Diagram: Context Lattice</text>

            <rect class="ji-boundary" x="288" y="94" rx="18" ry="18" width="544" height="372"></rect>
            <text class="arch-title" x="560" y="132" text-anchor="middle">Context Lattice System Boundary</text>

            <rect class="ji-panel" x="48" y="204" rx="16" ry="16" width="190" height="156"></rect>
            <text class="ji-label" x="143" y="242" text-anchor="middle">[A] External Actors</text>
            <text class="ji-meta" x="143" y="272" text-anchor="middle">Apps + agents</text>
            <text class="ji-meta" x="143" y="296" text-anchor="middle">MCP tools</text>
            <text class="ji-meta" x="143" y="320" text-anchor="middle">Messaging hooks</text>

            <rect class="ji-core" x="374" y="182" rx="16" ry="16" width="372" height="108"></rect>
            <text class="ji-label" x="560" y="224" text-anchor="middle">[B] Orchestrator Control Plane</text>
            <text class="ji-meta" x="560" y="250" text-anchor="middle">HTTP-first APIs + auth + policy</text>

            <rect class="ji-panel" x="374" y="318" rx="14" ry="14" width="176" height="104"></rect>
            <text class="ji-label" x="462" y="358" text-anchor="middle">[C] Memory Plane</text>
            <text class="ji-meta" x="462" y="384" text-anchor="middle">stores + retrieval</text>

            <rect class="ji-panel" x="570" y="318" rx="14" ry="14" width="176" height="104"></rect>
            <text class="ji-label" x="658" y="358" text-anchor="middle">[D] Ops + Safety</text>
            <text class="ji-meta" x="658" y="384" text-anchor="middle">queue + retention + security</text>

            <rect class="ji-panel" x="882" y="204" rx="16" ry="16" width="190" height="156"></rect>
            <text class="ji-label" x="977" y="242" text-anchor="middle">[E] Dependencies</text>
            <text class="ji-meta" x="977" y="272" text-anchor="middle">Model runtimes</text>
            <text class="ji-meta" x="977" y="296" text-anchor="middle">Tool providers</text>
            <text class="ji-meta" x="977" y="320" text-anchor="middle">Optional BYO cloud</text>

            <path class="ji-flow" d="M238 258 C292 258, 330 236, 374 236" marker-end="url(#ctx-arrow)"></path>
            <path class="ji-flow" d="M746 236 C790 236, 830 258, 882 258" marker-end="url(#ctx-arrow)"></path>
            <path class="ji-flow" d="M560 290 C560 304, 510 312, 462 318" marker-end="url(#ctx-arrow)"></path>
            <path class="ji-flow" d="M560 290 C560 304, 610 312, 658 318" marker-end="url(#ctx-arrow)"></path>

            <rect class="arch-legend" x="878" y="54" rx="10" ry="10" width="194" height="78"></rect>
            <text class="ji-meta" x="900" y="83">Legend</text>
            <path class="ji-flow" d="M900 104 L962 104" marker-end="url(#ctx-arrow)"></path>
            <text class="ji-meta" x="972" y="109">Request flow</text>
          </svg>
          <p class="muted-note arch-caption">Minimal context view: boundary clarity first, implementation detail second.</p>
        </article>

        <article class="card">
          <div class="kicker">Legend + Roles</div>
          <h3>What each context block means</h3>
          <div class="priority-row"><span class="priority-chip required">Required</span></div>
          <ul class="spec-list arch-note-list">
            <li><strong>[A] External Actors:</strong> clients that submit memory writes and search requests.</li>
            <li><strong>[B] Orchestrator:</strong> single control plane for ingress, auth, validation, and routing.</li>
            <li><strong>[C] Memory Plane:</strong> durable stores used for fanout and retrieval synthesis.</li>
            <li><strong>[D] Ops + Safety:</strong> controls for queue health, storage discipline, and policy.</li>
            <li><strong>[E] Dependencies:</strong> model/tool providers and optional cloud BYO services.</li>
          </ul>
        </article>
      </div>
    </section>

    <section class="section" id="arch-container">
      <div class="kicker">C4 Level 2</div>
      <h2>Container and Data Plane View</h2>
      <div class="grid arch-split">
        <article class="card architecture-board">
          <svg class="arch-svg ji" viewBox="0 0 1120 610" role="img" aria-label="Container diagram showing orchestrator, outbox fanout, retrieval engine, memory stores, and operations controls">
            <defs>
              <linearGradient id="ctr-panel" x1="0" x2="0" y1="0" y2="1">
                <stop offset="0%" stop-color="#1d2229" stop-opacity="0.9"/>
                <stop offset="100%" stop-color="#151a20" stop-opacity="0.9"/>
              </linearGradient>
              <linearGradient id="ctr-core" x1="0" x2="1" y1="0" y2="1">
                <stop offset="0%" stop-color="#232d3b" stop-opacity="0.98"/>
                <stop offset="100%" stop-color="#1a2230" stop-opacity="0.98"/>
              </linearGradient>
              <marker id="ctr-arrow" markerWidth="12" markerHeight="12" refX="10" refY="6" orient="auto">
                <path d="M0,0 L12,6 L0,12 z" fill="#dbe3ee"></path>
              </marker>
            </defs>

            <text class="arch-title" x="560" y="52" text-anchor="middle">Container Diagram: Context Lattice Runtime</text>

            <rect class="ji-panel" x="38" y="248" rx="14" ry="14" width="132" height="120"></rect>
            <text class="ji-label" x="104" y="288" text-anchor="middle">Clients</text>
            <text class="ji-meta" x="104" y="314" text-anchor="middle">apps + agents</text>
            <text class="ji-meta" x="104" y="338" text-anchor="middle">messaging</text>

            <rect class="ji-boundary" x="190" y="96" rx="18" ry="18" width="744" height="466"></rect>
            <text class="arch-title" x="562" y="134" text-anchor="middle">Context Lattice System Boundary</text>

            <rect class="ji-core" x="232" y="182" rx="14" ry="14" width="194" height="92"></rect>
            <text class="ji-label" x="329" y="218" text-anchor="middle">Orchestrator API</text>
            <text class="ji-meta" x="329" y="244" text-anchor="middle">HTTP ingress + policy</text>

            <rect class="ji-panel" x="448" y="182" rx="14" ry="14" width="176" height="92"></rect>
            <text class="ji-label" x="536" y="218" text-anchor="middle">Outbox Queue</text>
            <text class="ji-meta" x="536" y="244" text-anchor="middle">async fanout</text>

            <rect class="ji-panel" x="646" y="182" rx="14" ry="14" width="176" height="92"></rect>
            <text class="ji-label" x="734" y="218" text-anchor="middle">Retrieval Engine</text>
            <text class="ji-meta" x="734" y="244" text-anchor="middle">parallel + rerank</text>

            <rect class="ji-panel" x="232" y="306" rx="12" ry="12" width="146" height="88"></rect>
            <text class="ji-label" x="305" y="340" text-anchor="middle">Memory Bank</text>
            <text class="ji-meta" x="305" y="364" text-anchor="middle">canonical</text>

            <rect class="ji-panel" x="396" y="306" rx="12" ry="12" width="146" height="88"></rect>
            <text class="ji-label" x="469" y="340" text-anchor="middle">Qdrant</text>
            <text class="ji-meta" x="469" y="364" text-anchor="middle">vectors</text>

            <rect class="ji-panel" x="560" y="306" rx="12" ry="12" width="146" height="88"></rect>
            <text class="ji-label" x="633" y="340" text-anchor="middle">Mongo</text>
            <text class="ji-meta" x="633" y="364" text-anchor="middle">raw ledger</text>

            <rect class="ji-panel" x="724" y="306" rx="12" ry="12" width="146" height="88"></rect>
            <text class="ji-label" x="797" y="340" text-anchor="middle">MindsDB + Letta</text>
            <text class="ji-meta" x="797" y="364" text-anchor="middle">SQL + archival</text>

            <rect class="ji-panel" x="270" y="426" rx="12" ry="12" width="254" height="104"></rect>
            <text class="ji-label" x="397" y="464" text-anchor="middle">Ops Controls</text>
            <text class="ji-meta" x="397" y="490" text-anchor="middle">backpressure + retention</text>

            <rect class="ji-panel" x="548" y="426" rx="12" ry="12" width="286" height="104"></rect>
            <text class="ji-label" x="691" y="464" text-anchor="middle">Security + Reliability</text>
            <text class="ji-meta" x="691" y="490" text-anchor="middle">auth + secrets + health</text>

            <rect class="ji-panel" x="956" y="174" rx="14" ry="14" width="126" height="132"></rect>
            <text class="ji-label" x="1019" y="210" text-anchor="middle">Providers</text>
            <text class="ji-meta" x="1019" y="236" text-anchor="middle">Qwen/Ollama</text>
            <text class="ji-meta" x="1019" y="258" text-anchor="middle">LM Studio</text>
            <text class="ji-meta" x="1019" y="280" text-anchor="middle">OpenAI-comp.</text>

            <rect class="ji-panel" x="956" y="328" rx="14" ry="14" width="126" height="124"></rect>
            <text class="ji-label" x="1019" y="364" text-anchor="middle">Messaging</text>
            <text class="ji-meta" x="1019" y="390" text-anchor="middle">Telegram/Slack</text>
            <text class="ji-meta" x="1019" y="412" text-anchor="middle">OpenClaw family</text>

            <path class="ji-flow" d="M170 286 L232 228" marker-end="url(#ctr-arrow)"></path>
            <path class="ji-flow" d="M426 228 L448 228" marker-end="url(#ctr-arrow)"></path>
            <path class="ji-flow" d="M426 248 L646 228" marker-end="url(#ctr-arrow)"></path>

            <path class="ji-flow-async" d="M536 274 L536 292" marker-end="url(#ctr-arrow)"></path>
            <path class="ji-flow-async" d="M250 292 L852 292"></path>
            <path class="ji-flow-async" d="M305 292 L305 306" marker-end="url(#ctr-arrow)"></path>
            <path class="ji-flow-async" d="M469 292 L469 306" marker-end="url(#ctr-arrow)"></path>
            <path class="ji-flow-async" d="M633 292 L633 306" marker-end="url(#ctr-arrow)"></path>
            <path class="ji-flow-async" d="M797 292 L797 306" marker-end="url(#ctr-arrow)"></path>

            <path class="ji-flow" d="M734 274 L734 332" marker-end="url(#ctr-arrow)"></path>
            <path class="ji-flow" d="M734 332 L820 332"></path>
            <path class="ji-flow" d="M734 332 L648 332"></path>
            <path class="ji-flow" d="M305 332 C360 332, 420 332, 648 332"></path>
            <path class="ji-flow" d="M797 332 C774 332, 758 332, 734 332"></path>

            <path class="ji-flow-feedback" d="M797 394 C810 414, 792 434, 748 434 C724 434, 724 382, 734 274" marker-end="url(#ctr-arrow)"></path>

            <path class="ji-flow" d="M822 228 L956 228" marker-end="url(#ctr-arrow)"></path>
            <path class="ji-flow" d="M822 364 L956 364" marker-end="url(#ctr-arrow)"></path>

            <path class="ji-flow" d="M397 394 L397 426" marker-end="url(#ctr-arrow)"></path>
            <path class="ji-flow" d="M691 394 L691 426" marker-end="url(#ctr-arrow)"></path>

            <rect class="arch-legend" x="38" y="34" rx="10" ry="10" width="324" height="90"></rect>
            <text class="ji-meta" x="60" y="64">Legend</text>
            <path class="ji-flow" d="M60 84 L122 84" marker-end="url(#ctr-arrow)"></path>
            <text class="ji-meta" x="132" y="89">sync request/read</text>
            <path class="ji-flow-async" d="M60 104 L122 104" marker-end="url(#ctr-arrow)"></path>
            <text class="ji-meta" x="132" y="109">async outbox fanout</text>
            <path class="ji-flow-feedback" d="M236 104 L298 104" marker-end="url(#ctr-arrow)"></path>
            <text class="ji-meta" x="308" y="109">learning feedback</text>
          </svg>
          <p class="muted-note arch-caption">Data plane emphasizes one ingress path, one durable fanout path, and one retrieval egress path.</p>
        </article>

        <article class="card">
          <div class="kicker">Container Notes</div>
          <h3>Responsibilities and protocol posture</h3>
          <div class="priority-row"><span class="priority-chip required">Required</span></div>
          <ul class="spec-list arch-note-list">
            <li><strong>HTTP-first ingress:</strong> orchestrator is the single write/search endpoint.</li>
            <li><strong>MCP-compatible surface:</strong> tool clients connect through MCP hub + HTTP APIs.</li>
            <li><strong>Durable writes:</strong> outbox queue handles fanout retries and replay.</li>
            <li><strong>Retrieval egress:</strong> federated retrieval returns context plus feedback prompts.</li>
            <li><strong>Local-first default:</strong> local stores first, cloud BYO optional.</li>
          </ul>
        </article>
      </div>
    </section>

    <section class="section" id="arch-runtime">
      <div class="grid arch-grid">
        <article class="card">
          <div class="kicker">Dynamic View: Write Flow</div>
          <h3 class="runtime-flow-title">Write Flow</h3>
          <p class="muted-note">Order of operations</p>
          <ol class="step-list">
            <li>Authenticate and normalize write payload.</li>
            <li>Persist raw event for replay durability.</li>
            <li>Append async outbox fanout jobs.</li>
            <li>Dispatch sink writes with retries/backpressure.</li>
            <li>Record queue + sink telemetry.</li>
          </ol>
        </article>
        <article class="card">
          <div class="kicker">Dynamic View: Retrieval Flow</div>
          <h3 class="runtime-flow-title">Retrieval Flow</h3>
          <p class="muted-note">Order of operations</p>
          <ol class="step-list">
            <li>Receive scoped query (project/topic aware).</li>
            <li>Run parallel retrieval across sinks.</li>
            <li>Merge and rank candidates for retrieval egress.</li>
            <li>Prompt for context-quality feedback where appropriate.</li>
            <li>Write feedback signals to improve future ranking.</li>
          </ol>
        </article>
      </div>
    </section>

    <section class="section" id="arch-ops">
      <article class="card">
        <div class="kicker">Ops + Safety</div>
        <h3>Controls that keep long-horizon operation stable</h3>
        <ul class="spec-list">
          <li><strong>Queue durability:</strong> retries, deadletters, and replay workflows.</li>
          <li><strong>Write pressure management:</strong> backpressure + coalescing under burst load.</li>
          <li><strong>Storage hygiene:</strong> retention sweeps and external cold-path handoff.</li>
          <li><strong>Security posture:</strong> strict API-key auth and secrets redaction/block controls.</li>
          <li><strong>Operational confidence:</strong> health probes, telemetry, and update automation.</li>
        </ul>
      </article>
    </section>

    <footer class="footer">
      <span>Architecture reference</span>
      <span>Use this map for production troubleshooting and onboarding.</span>
    </footer>
  </main>
</body>
</html>
