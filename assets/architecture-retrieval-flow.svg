<svg xmlns="http://www.w3.org/2000/svg" width="1600" height="980" viewBox="0 0 1600 980" role="img" aria-label="Retrieval flow showing parallel recall, rerank, response, and learning loop">
  <defs>
    <linearGradient id="bg" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" stop-color="#192434"/>
      <stop offset="100%" stop-color="#111a25"/>
    </linearGradient>
    <marker id="arrow" markerWidth="10" markerHeight="10" refX="8" refY="5" orient="auto" markerUnits="userSpaceOnUse">
      <path d="M0 0 L10 5 L0 10 Z" fill="#deebfc"/>
    </marker>
    <marker id="arrowLearn" markerWidth="10" markerHeight="10" refX="8" refY="5" orient="auto" markerUnits="userSpaceOnUse">
      <path d="M0 0 L10 5 L0 10 Z" fill="#dcc18a"/>
    </marker>
    <style><![CDATA[
      .frame { fill: url(#bg); stroke: #69788b; stroke-width: 1.4; }
      .node { fill: #1f2b3a; stroke: #cfdbeb; stroke-width: 2; }
      .core { fill: #2b3d53; stroke: #e1eaf7; stroke-width: 2.2; }
      .title { font: 700 16px 'IBM Plex Mono', monospace; fill: #d4deeb; letter-spacing: 0.09em; }
      .label { font: 700 26px 'IBM Plex Sans', sans-serif; fill: #f1f6ff; }
      .sub { font: 600 20px 'IBM Plex Sans', sans-serif; fill: #d2ddec; }
      .lane { font: 700 24px 'IBM Plex Sans', sans-serif; fill: #d8e3f2; }
      .sync { stroke: #deebfc; stroke-width: 3; fill: none; stroke-linecap: round; stroke-linejoin: round; }
      .learn { stroke: #dcc18a; stroke-width: 3; fill: none; stroke-dasharray: 4 8; stroke-linecap: round; stroke-linejoin: round; }
    ]]></style>
  </defs>

  <rect x="0" y="0" width="1600" height="980" class="frame"/>
  <text x="800" y="60" text-anchor="middle" class="title">RETRIEVAL + LEARNING LOOP</text>

  <rect x="590" y="90" width="420" height="96" rx="20" class="node"/>
  <text x="800" y="148" text-anchor="middle" class="label">Query Request</text>

  <rect x="590" y="220" width="420" height="96" rx="20" class="core"/>
  <text x="800" y="278" text-anchor="middle" class="label">Orchestrator Query Handler</text>

  <rect x="590" y="350" width="420" height="96" rx="20" class="node"/>
  <text x="800" y="408" text-anchor="middle" class="label">Retrieval Engine</text>

  <text x="400" y="540" class="lane">Parallel Recall</text>
  <path class="sync" d="M800 446 V520 H1220"/>
  <path class="sync" d="M380 520 H800"/>

  <rect x="300" y="560" width="220" height="110" rx="20" class="node"/>
  <text x="410" y="622" text-anchor="middle" class="label">Memory Bank</text>

  <rect x="540" y="560" width="220" height="110" rx="20" class="node"/>
  <text x="650" y="622" text-anchor="middle" class="label">Qdrant</text>

  <rect x="780" y="560" width="220" height="110" rx="20" class="node"/>
  <text x="890" y="622" text-anchor="middle" class="label">Mongo</text>

  <rect x="1020" y="560" width="220" height="110" rx="20" class="node"/>
  <text x="1130" y="622" text-anchor="middle" class="label">MindsDB + Letta</text>

  <rect x="590" y="720" width="420" height="96" rx="20" class="node"/>
  <text x="800" y="778" text-anchor="middle" class="label">Merge + Rerank + Compose Context</text>

  <rect x="590" y="850" width="420" height="96" rx="20" class="node"/>
  <text x="800" y="908" text-anchor="middle" class="label">Return Context to Caller</text>

  <path class="sync" d="M800 186 V220" marker-end="url(#arrow)"/>
  <path class="sync" d="M800 316 V350" marker-end="url(#arrow)"/>

  <path class="sync" d="M410 520 V560" marker-end="url(#arrow)"/>
  <path class="sync" d="M650 520 V560" marker-end="url(#arrow)"/>
  <path class="sync" d="M890 520 V560" marker-end="url(#arrow)"/>
  <path class="sync" d="M1130 520 V560" marker-end="url(#arrow)"/>

  <path class="sync" d="M410 670 V700" marker-end="url(#arrow)"/>
  <path class="sync" d="M650 670 V700" marker-end="url(#arrow)"/>
  <path class="sync" d="M890 670 V700" marker-end="url(#arrow)"/>
  <path class="sync" d="M1130 670 V700" marker-end="url(#arrow)"/>
  <path class="sync" d="M410 700 H1130"/>
  <path class="sync" d="M800 700 V720" marker-end="url(#arrow)"/>
  <path class="sync" d="M800 816 V850" marker-end="url(#arrow)"/>

  <text x="1200" y="760" class="sub" fill="#dcc18a">learning write</text>
  <path class="learn" d="M1000 768 C1140 768,1160 690,1130 670" marker-end="url(#arrowLearn)"/>

  <text x="1210" y="644" class="sub" fill="#dcc18a">feedback return</text>
  <path class="learn" d="M1130 560 C1230 500,1200 360,1010 350" marker-end="url(#arrowLearn)"/>
</svg>
